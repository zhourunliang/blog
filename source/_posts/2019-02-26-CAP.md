---
layout: post
title:  "CAP定理"
date:   2019-02-26
tags: 分布式系统
---

# 什么是CAP

![CAP](/assets/img/blog/CAP.jpg)

1998年，加州大学的计算机科学家 Eric Brewer 提出，分布式系统有三个指标。

    Consistency（一致性）
    Availability（可用性）
    Partition tolerance（网络分区的可容忍性）

它们的第一个字母分别是 C、A、P。
Eric Brewer 说，这三个指标不可能同时做到。这个结论就叫做 CAP 定理。

## C 和 A 的矛盾
一致性和可用性，为什么不可能同时成立？答案很简单，因为可能通信失败（即出现分区容错）。

如果保证 G2 的一致性，那么 G1 必须在写操作时，锁定 G2 的读操作和写操作。只有数据同步后，才能重新开放读写。锁定期间，G2 不能读写，没有可用性不。

如果保证 G2 的可用性，那么势必不能锁定 G2，所以一致性不成立。

综上所述，G2 无法同时做到一致性和可用性。系统设计时只能选择一个目标。如果追求一致性，那么无法保证所有节点的可用性；如果追求所有节点的可用性，那就没法做到一致性。

## 可用性高于一致性
例如：stackoverflow这样的网站，内容是保存在多名服务器，但更新不一定全部更新，可以有些用户是旧的数据，有些用户是新的数据。

## 一致性高于可用性
例如：小米商城的抢购，银行系统等，要求一致性高，会牺牲可用性。

## 结论
设计分布式系统要充分考虑业务的需求，处理好CAP的关系。


## 参考资料

* [CAP 定理的含义 - 阮一峰的网络日志](http://www.ruanyifeng.com/blog/2018/07/cap.html)