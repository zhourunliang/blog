---
layout: post
title:  "PHP中cURL的使用"
date:   2019-02-14
tags: PHP
---

# PHP中cURL的使用

## cURL的get方法
```php
    function curl_get($url_head, $parms=[]) {
        
        $header = array(
            'Accept:application/json',
            'Content-Type:application/json;charset=utf-8',
        );

        if (!empty($parms)) {
            $url_parms = get_url_string($parms);
            $url = $url_head.'?'.$url_parms;
        }else{
            $url = $url_head;
        }

        // dump($url);
        $ch = curl_init();
        //设置选项，包括URL
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
        curl_setopt($ch, CURLOPT_HEADER, 0);

        //执行并获取HTML文档内容
        $result = curl_exec($ch);
        //释放curl句柄
        curl_close($ch);
        $r = json_decode($result, true);
        return $r;
    }

        /**
     *数组 转化url参数
    * @param string
    * @return mixed
    */
    function get_url_string($array_query)
    {
        $tmp = array();
        foreach($array_query as $k=>$param)
        {
            $tmp[] = $k.'='.urlencode($param);
        }
        $params = implode('&',$tmp);
        return $params;
    }
```

## cURL的post方法
```php
    function curl_post($url, $data) {
        
        // $header = array(
        //     'Accept:application/json',
        //     'Content-Type:application/json;charset=utf-8',
        // );

        $ch = curl_init($url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        // curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
        curl_setopt($ch,CURLOPT_POST,1);
        curl_setopt($ch,CURLOPT_POSTFIELDS,$data);
    
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);


        //执行并获取HTML文档内容
        $result = curl_exec($ch);
        //释放curl句柄
        curl_close($ch);
        $r = json_decode($result, true);
        return $r;

    }
```